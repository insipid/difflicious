<!-- Diff Groups -->
{% for group_key, group in groups.items() %}
{% if group.count > 0 %}
<div class="diff-group" style="display: flex; flex-direction: column; gap: var(--diff-element-gap);" data-group="{{ group_key }}">
    <!-- Group Header (hidden for staged-only view or ungrouped 'changes' view) -->
    {% set hide_header = (group_key == 'staged' and not unstaged and not untracked) or (group_key == 'changes' and not untracked) %}
    {% if not hide_header %}
    <div class="group-header flex items-center cursor-pointer hover:bg-gray-50 transition-colors rounded" 
         style="gap: var(--diff-element-gap); padding: var(--diff-element-gap) var(--diff-line-padding);"
         onclick="toggleGroup('{{ group_key }}')">
        <span class="toggle-icon text-gray-400 transition-transform duration-200" 
              data-expanded="true">â–¼</span>
        <h3 class="text-gray-700">{{ group_key|title }}</h3>
        <span class="text-xs text-gray-500 bg-gray-100 rounded" style="padding: var(--spacing-xs) var(--diff-element-gap);">
            {{ group.count }} files
        </span>
    </div>
    {% endif %}

    <!-- Group Files -->
    <div class="group-content" style="display: flex; flex-direction: column; gap: var(--diff-group-gap); {% if not hide_header %}margin-left: var(--diff-file-padding);{% endif %}" 
         data-group-content="{{ group_key }}">
        {% for file in group.files %}
        {% set group_name = group_key %}
        {% include "diff_file.html" with context %}
        {% endfor %}
    </div>
</div>
{% endif %}
{% endfor %}