<!-- Single File Diff -->
{% set file_id = group_name + ":" + file.path %}
<div class="file-diff bg-neutral-50 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-600 rounded-lg shadow-sm"
    data-file="{{ file_id }}">
    <!-- File Header -->
    <div class="file-header flex items-center justify-between p-4 cursor-pointer hover:bg-neutral-50 dark:hover:bg-neutral-700 transition-colors space-x-2"
        onclick="toggleFile('{{ file_id }}')">
        <!-- Left side: toggle, expand, filename, status - all flush left -->
        <div class="flex items-center space-x-3 flex-shrink min-w-0">
            <span
                class="toggle-icon text-neutral-400 dark:text-neutral-600 transition-transform duration-200 flex-shrink-0"
                data-expanded="{{ 'true' if file.expanded else 'false' }}">
                {{ 'â–¼' if file.expanded else 'â–¶' }}
            </span>
            <span
                class="expand-icon text-neutral-400 dark:text-neutral-600 hover:text-neutral-600 dark:hover:text-neutral-500 cursor-pointer transition-colors flex-shrink-0"
                onclick="loadFullDiff('{{ file.path }}', '{{ file_id }}'); event.stopPropagation()"
                title="Show complete file diff with unlimited context" id="expand-icon-{{ file_id }}">
                â†•
            </span>
            <div class="flex-1 min-w-0 break-words">
                <span class="font-mono text-sm text-neutral-900 dark:text-neutral-300" title="{{ file.path }}">
                    {%- if file.status == 'renamed' and file.old_path -%}
                    {{ file.old_path }} â†’ {{ file.path }}
                    {%- else -%}
                    {{ file.path }}
                    {%- endif -%}
                </span>
            </div>

            <!-- Status label positioned on the right when filename wraps -->
            <div class="flex items-center ml-4">
                <span class="status-badge
                    {%- if file.status == 'added' %} status-badge-added
                    {%- elif file.status == 'deleted' %} status-badge-deleted
                    {%- elif file.status == 'renamed' %} status-badge-renamed
                    {%- else %} status-badge-modified
                    {%- endif %}">
                    {%- if file.status == 'renamed' %}moved{%- else %}{{ file.status }}{%- endif %}
                </span>
            </div>
        </div>

        <!-- Right side: diff counts and navigation -->
        <div class="flex items-center space-x-2 text-xs flex-shrink-0 ml-6">
            <!-- File Stats -->
            {% if file.additions > 0 %}
            <span class="file-stat file-stat-addition">
                +{{ file.additions }}
            </span>
            {% endif %}
            {% if file.deletions > 0 %}
            <span class="file-stat file-stat-deletion">
                -{{ file.deletions }}
            </span>
            {% endif %}

            <!-- File Navigation -->
            <div class="flex items-center space-x-1" onclick="event.stopPropagation()">
                <button onclick="navigateToPreviousFile('{{ file_id }}')"
                    class="p-1 text-neutral-400 dark:text-neutral-600 hover:text-neutral-600 dark:hover:text-neutral-500 hover:bg-neutral-100 dark:hover:bg-neutral-700 rounded transition-colors"
                    title="Previous file">
                    <span class="text-sm">â†‘</span>
                </button>
                <button onclick="navigateToNextFile('{{ file_id }}')"
                    class="p-1 text-neutral-400 dark:text-neutral-600 hover:text-neutral-600 dark:hover:text-neutral-500 hover:bg-neutral-100 dark:hover:bg-neutral-700 rounded transition-colors"
                    title="Next file">
                    <span class="text-sm">â†“</span>
                </button>
            </div>
        </div>
    </div>

    <!-- File Content -->
    <div class="file-content border-t border-neutral-200 dark:border-neutral-600" data-file-content="{{ file_id }}"
        style="display: {{ 'block' if file.expanded else 'none' }};">
        {% if not file.hunks or file.hunks|length == 0 %}
        <!-- No content available -->
        <div class="p-8 text-center text-neutral-500 dark:text-neutral-400">
            <div class="text-4xl mb-2">ðŸ“„</div>
            <p>No diff content available</p>
            <p class="text-sm">(Binary file, untracked, or no changes)</p>
        </div>
        {% else %}
        <!-- Render hunks -->
        {% for hunk in file.hunks %}
        {% include "diff_hunk.html" with context %}
        {% endfor %}
        {% endif %}
    </div>
</div>
