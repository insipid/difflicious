# v1.0 Release Readiness Audit

**Date:** 2026-02-05
**Current Version:** 0.10.0
**Target Release:** 1.0.0

---

## Executive Summary

The codebase is functionally solid and architecturally well-organized, but has a number of issues that should be addressed before a v1.0 release. The most significant are: shipped dead code and debug logging in the frontend, several factual errors in user-facing documentation, known bugs noted in `TODO.org`, and metadata/config that still reflects pre-release status.

**Issues Found:** 52 total across codebase and documentation
- Critical (must-fix): 11
- High priority: 11
- Medium priority: 20
- Low priority: 10

---

## Table of Contents

1. [Codebase Audit](#codebase-audit)
   - [Critical](#codebase-critical)
   - [High Priority](#codebase-high-priority)
   - [Medium Priority](#codebase-medium-priority)
   - [Low Priority](#codebase-low-priority)
2. [Documentation Audit](#documentation-audit)
   - [Critical](#documentation-critical)
   - [High Priority](#documentation-high-priority)
   - [Medium Priority](#documentation-medium-priority)
   - [Low Priority](#documentation-low-priority)
3. [Action Plan](#action-plan)

---

## Codebase Audit

### Codebase: Critical

- [ ] **C1. Version still at 0.10.0**
  `src/difflicious/__init__.py:3` — `__version__ = "0.10.0"` needs to become `"1.0.0"`.

- [x] **C2. ~50+ unconditional `console.log` statements in shipped JS** ✅ FIXED
  Added DEBUG guards to all files. Legacy `diff-interactions.js` moved to reference.

- [x] **C3. Dead 983-line `app.js` shipped in package** ✅ FIXED
  Moved to `docs/reference/app.js.reference`.

- [ ] **C4. Known bugs in `TODO.org` need triage**
  Untracked file `TODO.org` documents 7 active issues including:
  - Hunk expansion sometimes broken
  - Merged expanded hunks show a bright line between them
  - "The whole hunkparching thing needs to be fixed"
  - Red box outlines from syntax highlighting
  These need to be triaged: fix for v1.0 or explicitly defer post-v1.0.

- [ ] **C5. pyproject.toml classifier says "Beta"**
  Line 14: `"Development Status :: 4 - Beta"` should be `"Development Status :: 5 - Production/Stable"`.

- [ ] **C6. Placeholder author email**
  `noreply@example.com` appears in `__init__.py:5` and `pyproject.toml:12`. For a PyPI release this should be a real email or omitted.

### Codebase: High Priority

- [ ] **H1. `cilicious.sh` modifies files instead of checking**
  Runs `black .` which reformats code. Should be `black --check .` for CI. Also missing `#!/bin/bash` shebang and `set -e`.

- [x] **H2. Potential XSS in `diff-interactions.js:1335`** ✅ FIXED
  Added `escapeJsString()` function to properly escape parameters in onclick handler.
  (Note: Legacy file also moved to reference; fix applied to `modules/full-diff.js`.)

- [ ] **H3. `diff_parser.py:14-41` uses `subprocess.run(["wc", "-l", ...])`**
  Passes `file_path` from parsed git diff output directly to subprocess without the repository-boundary validation that `git_operations._is_safe_file_path()` provides. Should use pure Python file reading (matching `git_operations.py:870-897` `get_file_line_count`).

- [x] **H4. Duplicate `DOMContentLoaded` initialization** ✅ FIXED
  Removed legacy `diff-interactions.js` (moved to `docs/reference/`). Only `main.js` now handles initialization.

- [x] **H5. Duplicate `$`/`$$` DOM utility definitions** ✅ FIXED
  Removed legacy `diff-interactions.js` (moved to `docs/reference/`). Only `modules/dom-utils.js` defines these now.

### Codebase: Medium Priority

- [ ] **M1. Integration tests aren't real pytest tests**
  `tests/integration/test_api.py`, `test_api_detailed.py`, `test_frontend.py` use `def main()` with print statements and `sys.path.insert`. They don't run in CI via `pytest`. Should be converted or moved out of test directory.

- [x] **M2. Dead parameters in `diff_service.py:27-43`** ✅
  Removed `unstaged` and `untracked` parameters from `get_grouped_diffs()` and `prepare_diff_data_for_template()`. Updated all call sites and tests. All data is always fetched; filtering happens client-side.

- [ ] **M3. Unused parameter in `template_service.py:40`**
  Accepts `target_commit` parameter but never uses it.

- [ ] **M4. Inconsistent error HTTP status codes**
  `git_routes.py:17` (`api_status`) returns 200 on error; `api_branches` (line 36) returns 500. Clients can't rely on status codes alone.

- [ ] **M5. ruff/black line-length mismatch**
  `pyproject.toml`: ruff allows 170 chars (line 64), black enforces 88 (line 81). Contradictory and unexplained.

- [ ] **M6. No tests for auto-reload routes/SSE**
  `auto_reload_routes.py` blueprint with `WatchManager`, `BroadcastQueue`, SSE streaming has no dedicated tests.

- [ ] **M7. No test for `diff_parser._get_file_line_count`**
  The function using `subprocess.run(["wc", "-l"])` has no direct tests.

- [ ] **M8. Limited JS test coverage**
  Only 4 test files exist. No tests for: `context-expansion.js`, `context-expansion-ui.js`, `full-diff.js`, `auto-reload.js`, `diffStore.js`, `searchStore.js`, `themeStore.js`, `fileComponent.js`, `groupComponent.js`, `hunkComponent.js`.

- [ ] **M9. Dual dev dependency specs in pyproject.toml**
  `[project.optional-dependencies] dev` (lines 39-46, stale versions like `pytest>=7.0.0`) and `[dependency-groups] dev` (lines 94-104, current versions like `pytest>=8.3.5`) coexist with conflicting version pins.

- [ ] **M10. `git_operations.py` mislabeled in docs**
  CLAUDE.md calls it "Legacy git utilities (being phased out)" but it is the core data layer used by every service via `BaseService`.

- [ ] **M11. Unvalidated commit refs in `git_operations.py:790-798`**
  `base_commit`/`target_commit` passed to `repo.git.diff()` without going through `_is_safe_commit_sha`.

### Codebase: Low Priority

- [x] **L1. `main.js:46` — `DiffState.init()` commented out** ✅ FIXED
  Condensed verbose migration comment block to concise 2-line note.

- [ ] **L2. `get_font_config()` return type is bare `dict`**
  `config.py:46` — Should be `dict[str, Any]`.

- [ ] **L3. `inject_font_config` return type uses bare `dict`**
  `app.py:47` — Inner `dict` should be `dict[str, Any]`.

- [ ] **L4. No upper bounds on runtime dependencies**
  All use floor constraints only (e.g., `flask>=2.3.0`). Consider ceiling constraints for major versions.

- [ ] **L5. `twine` in dev dependencies**
  `pyproject.toml:101` — Publishing tool mixed in with dev tools. Consider a separate `publish` dependency group.

---

## Documentation Audit

### Documentation: Critical

- [ ] **D1. README.md:45 — Wrong Docker image name**
  Says `difflicious/difflicious` but everywhere else (INSTALLATION.md, CONTRIBUTING.md, GitHub Actions) it is `insipid/difflicious:latest`.

- [ ] **D2. INSTALLATION.md:72-74, 260 — Phantom env var `DIFFLICIOUS_REPO_PATH`**
  Documented as a supported environment variable but does not exist in the source code. Users following this instruction get no effect.

- [ ] **D3. CHANGELOG.md:44, 53 — Impossible version dates**
  Versions 0.9.1 and 0.9.2 dated `2025-01-28` but 0.9.0 is `2025-10-31`. The dates are chronologically impossible (patches released 9 months before the version they patch).

- [ ] **D4. README.md:18 — Wrong syntax highlighting library**
  Says "Highlight.js" and "30+ languages" but the project uses Pygments (server-side) supporting 100+ languages.

- [ ] **D5. CHANGELOG.md — No 1.0.0 entry**
  Needs a v1.0.0 section drafted before release.

### Documentation: High Priority

- [ ] **D6. README.md:152-157 — SSE listed as future, but it's implemented**
  "Real-time updates with Server-Sent Events" listed under "Future Enhancements" but already exists in `auto_reload_routes.py` and `file_watcher.py`.

- [ ] **D7. CHANGELOG.md:148-153 — Same SSE issue**
  Listed under "Under Consideration" but already implemented.

- [ ] **D8. CLAUDE.md project structure tree — Missing 10+ entries**
  Missing directories/files: `components/`, `stores/`, full `modules/` contents, `alpine-init.js`, `auto_reload_routes.py`, `file_watcher.py`, several template partials.

- [ ] **D9. CONTRIBUTING.md:203-207 — Wrong package manager**
  Uses `npm` commands but project uses `pnpm`. Should be `pnpm run lint:js`, etc.

- [ ] **D10. pyproject.toml — Dual conflicting dev dependency groups**
  (Same as M9 above — `[project.optional-dependencies]` has stale versions vs `[dependency-groups]`.)

- [ ] **D11. CONTRIBUTING.md — No mention of `cilicious.sh`**
  The critical CI script is absent from the contributing workflow documentation.

### Documentation: Medium Priority

- [ ] **D12. README.md:119 — Says "vanilla CSS" but project uses Tailwind**
  Frontend description: "Alpine.js + vanilla CSS" should be "Alpine.js + Tailwind CSS".

- [ ] **D13. README.md:161 — Contributing section says "early development"**
  Inappropriate for v1.0. Full CONTRIBUTING.md exists but README doesn't link to it properly.

- [ ] **D14. README.md — No badges or screenshots**
  A visual diff tool has no visual preview. No PyPI badge, no CI badge, no license badge.

- [ ] **D15. README.md:147 — Stale test count/coverage numbers**
  "169 tests, 86% coverage" likely outdated from v0.9.0.

- [ ] **D16. INSTALLATION.md:262 — Phantom `PORT` env var**
  Listed in environment variables table but may not be implemented. CLI uses `--port` flag.

- [ ] **D17. INSTALLATION.md — Significant duplication with README.md**
  Quick start, font customization sections largely duplicated. Should cross-reference instead.

- [ ] **D18. CONTRIBUTING.md — Outdated project structure tree**
  Missing `blueprints/`, `components/`, `stores/`, `modules/` and many new files.

- [ ] **D19. CONTRIBUTING.md:147 — Coverage target inconsistency**
  Says 80%+ here but CLAUDE.md says 70%+. Should agree.

- [ ] **D20. docs/javascript-modularization-plan.md — Status never updated**
  Plan partially executed (module files exist) but `diff-interactions.js` still exists at 1,660 lines. Status is unclear.

- [ ] **D21. docs/2025-11-18-alpine-component-architecture.md — Unclear status**
  Marked "Active Development." Two competing frontend architectures (Alpine components + vanilla JS) coexist without clarity on which is canonical.

- [ ] **D22. pyproject.toml — Missing classifiers and URLs**
  Missing: `Framework :: Flask`, `Environment :: Web Environment`, Python 3.13, `Documentation` URL, `Changelog` URL.

- [ ] **D23. CHANGELOG.md:157-176 — Duplicative release notes section**
  v0.9.0 information repeated at the bottom of the file. Redundant.

- [ ] **D24. CHANGELOG.md:139-146 — Stale "Planned for 1.0" section**
  Written before v0.10.0. Should be updated with actual remaining work.

### Documentation: Low Priority

- [ ] **D25. PLAN.md — Should be marked as historical document**
  Still reads as an active plan. Needs a prominent header clarifying it's for historical reference.

- [ ] **D26. CLAUDE.md — Missing `watchdog` from Key Dependencies**
  Listed in pyproject.toml but absent from the CLAUDE.md dependencies section.

- [ ] **D27. docs/CSS-STYLE-GUIDE.md:586 — Hardcoded line number references**
  References to specific lines in `styles.css` will go stale. Should use section names instead.

- [ ] **D28. docs/ — Internal dev artifacts clutter the directory**
  ~30+ files across `notes/`, `sessions/`, `prompts/`, `proposals/`, `reports/` are internal development artifacts. Consider `docs/internal/` or excluding from PyPI distribution.

- [ ] **D29. TODO.org — Untracked file in repo root**
  Visible in `git status`. Should be `.gitignore`d or deleted for a clean v1.0.

- [ ] **D30. CLAUDE.md — No version reference at top**
  Doesn't indicate which version it documents. Add a "Last Updated" header.

---

## Action Plan

Suggested order of operations, grouped into workable batches.

### Batch 1: Release Metadata & Config (Quick Wins)

- [ ] Bump `__version__` to `1.0.0` — `__init__.py` (C1)
- [ ] Update pyproject.toml classifier to `Production/Stable` (C5)
- [ ] Fix placeholder email in `__init__.py` and `pyproject.toml` (C6)
- [ ] Reconcile dual dev dependency groups in pyproject.toml (M9/D10)
- [ ] Add missing classifiers and URLs to pyproject.toml (D22)
- [ ] Fix `cilicious.sh`: add shebang, `set -e`, use `black --check .` (H1)

### Batch 2: Frontend Cleanup ✅ COMPLETED

- [x] Remove or relocate dead `app.js` (C3) — moved to `docs/reference/app.js.reference`
- [x] Remove/gate all unconditional `console.log` statements (C2) — added DEBUG guards
- [x] Fix XSS in `loadFullDiff` retry button onclick (H2) — added `escapeJsString()`
- [x] Resolve duplicate `DOMContentLoaded` initialization (H4) — removed legacy file
- [x] Resolve duplicate `$`/`$$` DOM utilities (H5) — removed legacy file
- [x] Clean up commented-out `DiffState.init()` (L1) — condensed comment block

**Branch:** `frontend-cleanup-v1.0` (pushed to remote)
**Commits:** 6 commits for individual changes

### Batch 3: Bug Triage

- [ ] Review all bugs in `TODO.org` and decide: fix for v1.0 or defer (C4)
- [ ] Fix or document any deferred bugs

### Batch 4: Backend Cleanup

- [ ] Replace `wc -l` subprocess in `diff_parser.py` with Python (H3)
- [ ] Remove dead parameters from `diff_service.py` (M2)
- [ ] Remove unused `target_commit` param from `template_service.py` (M3)
- [ ] Harmonize ruff/black line-length or document why they differ (M5)
- [ ] Fix inconsistent HTTP status codes in error responses (M4)
- [ ] Validate commit refs in `git_operations.py` (M11)

### Batch 5: README.md Fixes

- [ ] Fix Docker image name (D1)
- [ ] Fix Highlight.js to Pygments, 30+ to 100+ (D4)
- [ ] Move SSE from "Future" to implemented features (D6)
- [ ] Fix "vanilla CSS" to "Tailwind CSS" (D12)
- [ ] Rewrite contributing section, link to CONTRIBUTING.md (D13)
- [ ] Add badges (PyPI, Python version, license, CI) (D14)
- [ ] Add screenshot(s) of light/dark mode (D14)
- [ ] Update or remove stale test count/coverage numbers (D15)

### Batch 6: Other Documentation Fixes

- [ ] Fix CHANGELOG dates for 0.9.1/0.9.2 (D3)
- [ ] Draft CHANGELOG 1.0.0 entry (D5)
- [ ] Remove SSE from "Under Consideration" in CHANGELOG (D7)
- [ ] Remove duplicate release notes section from CHANGELOG (D23)
- [ ] Update "Planned for 1.0" in CHANGELOG (D24)
- [ ] Remove or implement `DIFFLICIOUS_REPO_PATH` in INSTALLATION.md (D2)
- [ ] Verify or remove `PORT` env var in INSTALLATION.md (D16)
- [ ] Reduce duplication between INSTALLATION.md and README (D17)
- [ ] Fix `npm` to `pnpm` in CONTRIBUTING.md (D9)
- [ ] Add `cilicious.sh` to CONTRIBUTING.md workflow (D11)
- [ ] Align coverage targets across docs (D19)

### Batch 7: CLAUDE.md & Internal Docs

- [ ] Update project structure tree (D8)
- [ ] Remove "being phased out" label from `git_operations.py` (M10)
- [ ] Add `watchdog` to Key Dependencies (D26)
- [ ] Add version reference header (D30)
- [ ] Update CONTRIBUTING.md project structure tree (D18)
- [ ] Update javascript-modularization-plan.md status (D20)
- [ ] Clarify Alpine component architecture doc status (D21)
- [ ] Mark PLAN.md as historical (D25)

### Batch 8: Polish & Low Priority

- [ ] Fix bare `dict` return types in `config.py`, `app.py` (L2, L3)
- [ ] Consider upper bounds on runtime dependencies (L4)
- [ ] Move `twine` to separate dependency group (L5)
- [ ] Use section names instead of line numbers in CSS guide (D27)
- [ ] Organize `docs/` internal artifacts (D28)
- [ ] Delete or `.gitignore` `TODO.org` (D29)

### Batch 9: Test Improvements (Post-v1.0 OK)

- [ ] Convert or relocate integration test scripts (M1)
- [ ] Add tests for auto-reload routes/SSE (M6)
- [ ] Add test for `_get_file_line_count` (M7)
- [ ] Expand JS test coverage (M8)

---

## Notes

- Items marked with issue codes (e.g., C1, H2, D4) cross-reference the detailed findings above.
- Batches 1-6 are recommended before tagging v1.0.
- Batches 7-8 are strongly recommended but could land as a v1.0.1 patch.
- Batch 9 (test improvements) can follow post-release.
